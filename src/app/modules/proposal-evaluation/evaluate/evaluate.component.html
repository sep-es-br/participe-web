<app-template>
  <div class="row" *ngIf="this.readOnlyProposalEvaluation">
    <div class="col-12 d-flex flex-row justify-content-end">
      <button
        pButton
        text="true"
        severity="secondary"
        icon="pi pi-pencil"
        class="mx-2"
        type="button"
        (click)="switchEdit()"
      ></button>

      <button
        pButton
        text="true"
        severity="secondary"
        icon="pi pi-trash"
        class="mx-2"
        type="button"
        (click)="delete()"
      ></button>
    </div>
  </div>

  <div class="row">
    <div class="col-4">
      <label>{{
        (readOnlyProposalEvaluation
          ? "propeval.evaluated_by"
          : "propeval.under_evaluation_by"
        ) | translate
      }}</label>
      <div class="evaluator-div">
        <button
          class="org-badge pe-none"
          [ngClass]="{
            evaluated: proposal.evaluationStatus,
            'not-evaluated': !proposal.evaluationStatus
          }"
        >
          {{ getOrgName(1) }}
        </button>
        <span>{{ getOrgName(0) }}</span>
      </div>

      <br />
      <label>{{ domainConfigNames["planItemAreaTypeName"] }}</label>
      <p>{{ proposal.planItemAreaName }}</p>
    </div>
    <div class="col-4">
      <label>{{ domainConfigNames["localityTypeName"] }}</label>
      <p>{{ proposal.localityName }}</p>
      <br />
      <label>{{ domainConfigNames["planItemTypeName"] }}</label>
      <p>{{ proposal.planItemName }}</p>
    </div>
  </div>
  <div class="row">
    <div class="col-8">
      <label>{{ "propeval.description" | translate }}</label>
      <p>{{ proposal.description }}</p>
    </div>
  </div>

  <form
    [formGroup]="proposalEvaluationForm"
    *ngIf="!loading && !this.readOnlyProposalEvaluation"
  >
    <div class="row">
      <div class="col-8">
        <label>{{ "propeval.loaIncluded_question" | translate }}</label>
        <div class="col-3 d-flex justify-content-between">
          <div class="d-inline-flex align-items-center">
            <p-radioButton
              inputId="loaIncludedTrue"
              [value]="true"
              formControlName="includedInNextYearLOA"
              (onClick)="loaChanged($event)"
            ></p-radioButton>
            <label for="loaIncludedTrue" class="ms-2">{{
              "yes" | translate
            }}</label>
          </div>
          <div class="d-inline-flex align-items-center">
            <p-radioButton
              inputId="loaIncludedFalse"
              [value]="false"
              formControlName="includedInNextYearLOA"
              (onClick)="loaChanged($event)"
            ></p-radioButton>
            <label for="loaIncludedFalse" class="ms-2">{{
              "no" | translate
            }}</label>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-8">
        <ng-container *ngIf="formLoaIncluded != null && formLoaIncluded">
          <div class="col-12 d-flex flex-column">
            <label for="budgetUnit">{{
              "propeval.budgetUnit" | translate
            }}</label>
            <p-dropdown
              [options]="budgetUnitOptions"
              filter="true"
              formControlName="budgetUnit"
              styleClass="d-flex form-control"
              class="ng-dirty ng-invalid"
            ></p-dropdown>
            <tt-input-message
              [form]="proposalEvaluationForm"
              field="budgetUnit"
            ></tt-input-message>
          </div>

          <br />

          <div class="col-12 d-flex flex-column">
            <label for="budgetAction">{{
              "propeval.budgetAction" | translate
            }}</label>
            <p-multiSelect
              [options]="budgetActionOptions"
              display="chip"
              showClear="true"
              showToggleAll="false"
              [selectionLimit]="3"
              formControlName="budgetAction"
              styleClass="d-flex form-control"
              class="ng-dirty ng-invalid"
            ></p-multiSelect>
            <tt-input-message
              [form]="proposalEvaluationForm"
              field="budgetAction"
            ></tt-input-message>
          </div>

          <br />

          <div class="col-12 d-flex flex-column">
            <label for="budgetPlan">{{
              "propeval.budgetPlan" | translate
            }}</label>
            <input
              type="text"
              pInputText
              formControlName="budgetPlan"
              class="ng-dirty ng-invalid form-control"
            />
            <tt-input-message
              [form]="proposalEvaluationForm"
              field="budgetPlan"
            ></tt-input-message>
          </div>

          <br />
        </ng-container>
        <ng-container *ngIf="formLoaIncluded != null && !formLoaIncluded">
          <label for="reason">{{ "propeval.reason" | translate }}?</label>
          <div class="col-12 d-flex flex-column">
            <ng-container *ngFor="let reason of reasonOptions">
              <div class="d-inline-flex align-items-center">
                <p-radioButton
                  inputId="reason"
                  [value]="reason"
                  formControlName="reason"
                ></p-radioButton>
                <label for="reason" name="reason" class="ms-2">{{
                  reason
                }}</label>
              </div>
            </ng-container>
            <tt-input-message
              [form]="proposalEvaluationForm"
              field="reason"
            ></tt-input-message>
          </div>
        </ng-container>
      </div>
    </div>

    <div class="row">
      <div class="col-8">
        <button
          pButton
          icon="pi pi-check"
          [label]="'save' | translate"
          class="mx-2"
          type="submit"
          (click)="saveProposalEvaluation(proposalEvaluationForm)"
        ></button>

        <button
          pButton
          icon="pi pi-ban"
          [label]="'cancel' | translate"
          class="mx-2"
          type="button"
          (click)="cancel()"
        ></button>
      </div>
    </div>
  </form>

  <form
    [formGroup]="proposalEvaluationForm"
    *ngIf="!loading && this.readOnlyProposalEvaluation"
  >
    <div class="row">
      <div class="col-8">
        <label>{{ "propeval.loaIncluded" | translate }}</label>
        <p>{{ (formLoaIncluded ? "yes" : "no") | translate }}</p>
      </div>
    </div>

    <ng-container *ngIf="formLoaIncluded">
      <div class="row">
        <div class="col-8">
          <label>{{ "propeval.budgetUnit" | translate }}</label>
          <p>{{ formBudgetUnit }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-8">
          <label>{{ "propeval.budgetAction" | translate }}</label>
          <p>{{ formBudgetAction }}</p>
        </div>
      </div>

      <div class="row">
        <div class="col-8">
          <label>{{ "propeval.budgetPlan" | translate }}</label>
          <p>{{ formBudgetPlan }}</p>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="!formLoaIncluded">
      <div class="row">
        <div class="col-8">
          <label>{{ "propeval.reason" | translate }}</label>
          <p>{{ formReason }}</p>
        </div>
      </div>
    </ng-container>

    <div class="row">
      <div class="col-8">
        <label>{{ "propeval.evaluator" | translate }}</label>
        <p>{{ proposal.evaluatorName }}</p>
      </div>
    </div>
  </form>

  <p-confirmDialog
    [header]="'propeval.delete' | translate"
    icon="pi pi-exclamation-triangle"
    key="deleteProposalEvaluation"
  >
  </p-confirmDialog>
</app-template>
