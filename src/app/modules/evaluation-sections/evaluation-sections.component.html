<app-template>
  <div class="row">
    <div class="col-12">
      <div class="card card-w-title">
        <ng-container *ngIf="!showForm">
          <div class="row">
            <div class="col-5">
              <button
                pButton
                type="button"
                class="button-new"
                [label]="'new' | translate"
                (click)="showCreateEvaluator()"
                icon="pi pi-plus"
              ></button>
            </div>
            <div class="col-2"></div>
            <div class="col-5 d-flex justify-content-end align-items-center">
              <a class="pointer" (click)="showSearchForm()">{{
                (search ? "hide" : "search") | translate
              }}</a>
            </div>
          </div>
          <ng-container *ngIf="search">
            <div class="row my-3">
              <form [formGroup]="searchForm" (submit)="searchEvaluators()">
                <div
                  class="d-flex flex-row justify-content-between align-items-end"
                >
                  <div class="col-3">
                    <label for="searchEntity">Órgão</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="entity"
                      pInputText
                    />
                  </div>
                  <div class="col-3">
                    <label for="searchSection">Setor</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="section"
                      pInputText
                    />
                  </div>
                  <div class="col-3">
                    <label for="searchServer">Servidor</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="server"
                      pInputText
                    />
                  </div>
                  <div class="col-3 d-inline-flex justify-content-center">
                    <button
                      pButton
                      class=""
                      [icon]="loadingIcon('pi pi-search')"
                      [disabled]="loading"
                      type="submit"
                      [label]="'search' | translate"
                    ></button>
                  </div>
                </div>
              </form>
            </div>
          </ng-container>
          <div class="row">
            <div class="col-12">
              <p-table [value]="data" class="data-column">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Órgão</th>
                    <th>Setor</th>
                    <th>Servidor</th>
                    <th></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-data>
                  <tr>
                    <td>{{ data.entity }}</td>
                    <td>{{ data.section }}</td>
                    <td>{{ data.server }}</td>
                    <td class="column-actions">
                      <button
                        pButton
                        class="ui-button btn-icon"
                        (click)="showCreateEvaluator(data)"
                      >
                        <img
                          src="assets/layout/images/icons/triangule_plus.png"
                          alt=""
                        />
                      </button>
                      <button
                        pButton
                        class="ui-button btn-icon"
                        type="button"
                        (click)="showEdit(data)"
                      >
                        <i class="pi pi-pencil"></i>
                      </button>
                      <button
                        pButton
                        class="ui-button btn-icon"
                        type="button"
                        (click)="delete(data)"
                      >
                        <i class="pi pi-trash"></i>
                      </button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="showForm">
          <div class="row">
            <div class="col-6">
              <div class="col-12">
                <span class="fw-bold">Avaliadores</span>
              </div>
              <form
                [formGroup]="evaluatorsForm"
                (submit)="saveEvaluatorsForm()"
              >
                <div class="col-12">
                  <label for="entity">Orgao</label>
                  <p-dropdown
                    [options]="entityList"
                    formControlName="entity"
                    (onChange)="entityChanged($event)"
                    styleClass="d-flex form-control"
                    class="ng-dirty ng-invalid"
                  ></p-dropdown>
                </div>
                <div class="col-12">
                  <label for="sections">Setor</label>
                  <p-multiSelect
                    [options]="sectionList"
                    formControlName="sections"
                    display="chip"
                    showClear="true"
                    (onChange)="sectionsChanged($event)"
                    styleClass="d-flex form-control"
                    class="ng-dirty ng-invalid"
                  ></p-multiSelect>
                </div>
                <div class="col-12">
                  <label for="servers">Servidor</label>
                  <p-multiSelect
                    [options]="serverList"
                    formControlName="servers"
                    display="chip"
                    showClear="true"
                    styleClass="d-flex form-control"
                    class="ng-dirty ng-invalid"
                  ></p-multiSelect>
                </div>
                <div class="col-12 form-actions">
                  <button
                    pButton
                    icon="pi pi-check"
                    type="submit"
                    [label]="'save' | translate"
                  ></button>
                  <button
                    pButton
                    icon="pi pi-ban"
                    type="button"
                    [label]="'cancel' | translate"
                    (click)="showForm = false"
                  ></button>
                </div>
              </form>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</app-template>
