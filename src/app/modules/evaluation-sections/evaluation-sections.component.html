<app-template>
  <div class="row">
    <div class="col-12">
      <div class="card card-w-title">
        <ng-container *ngIf="!showForm">
          <div class="row">
            <div class="col-5">
              <button
                pButton
                type="button"
                class="button-new"
                [label]="'new' | translate"
                (click)="showCreateEvaluator()"
                icon="pi pi-plus"
              ></button>
            </div>
            <div class="col-2"></div>
            <div class="col-5 d-flex justify-content-end align-items-center">
              <a class="pointer" (click)="showSearchForm()">{{
                (search ? "hide" : "search") | translate
              }}</a>
            </div>
          </div>
          <ng-container *ngIf="search">
            <div class="row my-3">
              <form [formGroup]="searchForm" (submit)="searchEvaluators()">
                <div
                  class="d-flex flex-row justify-content-between align-items-end"
                >
                  <div class="col-3">
                    <label for="searchOrganization">{{
                      "evaluation-section.organization" | translate
                    }}</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="searchOrganization"
                      pInputText
                    />
                  </div>
                  <div class="col-3">
                    <label for="searchSection">{{
                      "evaluation-section.section" | translate
                    }}</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="searchSection"
                      pInputText
                    />
                  </div>
                  <div class="col-3">
                    <label for="searchServer">{{
                      "evaluation-section.server" | translate
                    }}</label>
                    <input
                      type="text"
                      class="form-control"
                      formControlName="searchServer"
                      pInputText
                    />
                  </div>
                  <div class="col-3 d-inline-flex justify-content-center">
                    <button
                      pButton
                      class=""
                      [icon]="loadingIcon('pi pi-search')"
                      [disabled]="loading"
                      type="submit"
                      [label]="'search' | translate"
                    ></button>
                  </div>
                </div>
              </form>
            </div>
          </ng-container>
          <div class="row">
            <div class="col-12">
              <p-table
                [value]="evaluationSectionsList"
                responsiveLayout="stack"
                class="data-column"
              >
                <ng-template pTemplate="header">
                  <tr>
                    <th>
                      {{ "evaluation-section.organization" | translate }}
                    </th>
                    <th>{{ "evaluation-section.sections" | translate }}</th>
                    <th>{{ "evaluation-section.servers" | translate }}</th>

                    <th></th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-evaluationSection>
                  <tr>
                    <td>{{ evaluationSection.organizationGuid }}</td>
                    <td>{{ evaluationSection.sectionsGuid }}</td>
                    <td>{{ evaluationSection.serversGuid ?? "Todos" }}</td>
                    <td class="column-actions">
                      <button
                        pButton
                        class="ui-button btn-icon"
                        type="button"
                        (click)="showEditEvaluator(evaluationSection)"
                      >
                        <i class="pi pi-pencil"></i>
                      </button>
                      <button
                        pButton
                        class="ui-button btn-icon"
                        type="button"
                        (click)="deleteEvaluationSection(evaluationSection)"
                      >
                        <i class="pi pi-trash"></i>
                      </button>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="showForm">
          <div class="row">
            <div class="col-12">
              <span>{{ formHeaderText | translate }}</span>
            </div>

            <form
              [formGroup]="evaluatorsForm"
              (submit)="saveEvaluatorsForm(evaluatorsForm)"
            >
              <div class="col-6">
                <label for="organizationGuid">{{
                  "evaluation-section.organization" | translate
                }}</label>
                <p-dropdown
                  [options]="organizationsList"
                  optionLabel="name"
                  optionValue="guid"
                  [readonly]="editEvaluatorSection"
                  formControlName="organizationGuid"
                  (onChange)="organizationChanged($event)"
                  styleClass="d-flex form-control"
                  class="ng-dirty ng-invalid"
                ></p-dropdown>
                <tt-input-message
                  [form]="evaluatorsForm"
                  field="organizationGuid"
                ></tt-input-message>
              </div>
              <div class="col-6">
                <label for="sectionsGuid">{{
                  "evaluation-section.section" | translate
                }}</label>
                <p-multiSelect
                  [options]="sectionsList"
                  optionLabel="name"
                  optionValue="guid"
                  formControlName="sectionsGuid"
                  display="chip"
                  showClear="true"
                  (onChange)="sectionsChanged($event)"
                  (onClear)="sectionsCleared()"
                  styleClass="d-flex form-control"
                  class="ng-dirty ng-invalid"
                ></p-multiSelect>
                <tt-input-message
                  [form]="evaluatorsForm"
                  field="sectionsGuid"
                ></tt-input-message>
              </div>
              <div class="col-6">
                <label for="serversGuid">{{
                  "evaluation-section.server" | translate
                }}</label>
                <p-multiSelect
                  [options]="serversList"
                  optionLabel="name"
                  optionValue="guid"
                  formControlName="serversGuid"
                  display="chip"
                  showClear="true"
                  styleClass="d-flex form-control"
                  class="ng-dirty ng-invalid"
                ></p-multiSelect>
              </div>
              <div class="col-12 form-actions">
                <button
                  pButton
                  icon="pi pi-check"
                  type="submit"
                  [label]="'save' | translate"
                ></button>
                <button
                  pButton
                  icon="pi pi-ban"
                  type="button"
                  [label]="'cancel' | translate"
                  (click)="cancelForm()"
                ></button>
              </div>
            </form>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</app-template>
