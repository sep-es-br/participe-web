<app-template>
  <div class="p-grid ui-fluid">
    <div class="p-col-12 p-lg-12">
      <div class="card card-w-title">
        <section *ngIf="!showDomainForm && !showLocalityForm">
          <div class="p-grid ui-fluid actions">
            <div class="ui-g-5 ui-md-1">
              <button pButton type="button" label="New" (click)="showCreateDomain()">
                <img src="assets/layout/images/icons/triangule_plus.png" />
              </button>
            </div>
            <div class="ui-g-2 ui-md-10"></div>
            <div class="ui-g-5 ui-md-1 search">
              <a class="search" (click)="toogleSearch()">{{ search ? 'Hide' : 'Search' }}</a>
            </div>
          </div>
          <div class="search-form" *ngIf="search">
            <form [formGroup]="searchForm" (submit)="searchDomains(searchForm.value)">
              <div class="p-grid ui-fluid">
                <div class="ui-g-12 ui-md-6">
                  <input pInputText placeholder="Domain name" formControlName="query">
                </div>
                <div class="ui-g-12 ui-md-1">
                  <button pButton icon="pi pi-search" type="submit" label="Search"></button>
                </div>
              </div>
            </form>
          </div>
          <p-treeTable #tt [value]="domainTree" selectionMode="single" class="tree-column">
            <ng-template pTemplate="header">
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th></th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowNode let-rowData="rowData" let-columns="columns">
              <tr>
                <td>
                  <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                  <span style="vertical-align: middle">{{rowData.name}}</span>
                </td>
                <td>
                  {{ rowData.type && rowData.type.name }}
                </td>
                <td class="column-actions">
                  <button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only" (click)="showCreateLocality(rowNode)">
                    <img src="assets/layout/images/icons/triangule_plus.png" />
                  </button>
                  <button pButton icon="pi pi-pencil" type="button" style="margin-right: 2px;"
                    (click)="showEdit(rowNode)"></button>
                  <button pButton icon="pi pi-trash" type="button" (click)="delete(rowNode)"></button>
                </td>
              </tr>
            </ng-template>
          </p-treeTable>
        </section>
        <section class="p-grid ui-fluid" *ngIf="showDomainForm">
          <form [formGroup]="domainForm" (submit)="saveDomain(domainForm.value)">
            <div class="p-col-12 p-md-6">
              <input pInputText placeholder="Domain name" formControlName="name">
              <tt-input-message [form]="domainForm" field="name"></tt-input-message>
            </div>
            <div class="p-col-12 p-md-4">
              <div class="form-actions">
                <button pButton icon="pi pi-check" type="submit" label="Save"></button>
                <button pButton icon="pi pi-ban" type="button" label="Cancel" (click)="clearDomainForm(null)"></button>
              </div>
            </div>
          </form>
        </section>
        <section class="p-grid ui-fluid" *ngIf="showLocalityForm">
          <form [formGroup]="localityForm" (submit)="saveLocality(localityForm.value)">
            <div class="p-col-12 p-md-6">
              {{ localityBreadcrumb }}
            </div>
            <div class="p-col-12 p-md-6">
              <p-dropdown [options]="types" [disabled]="disableSelectLocalityType" formControlName="type"
                class="ng-dirty ng-invalid" placeholder="Type"></p-dropdown>
              <tt-input-message [form]="localityForm" field="type"></tt-input-message>
            </div>
            <div class="p-col-12 p-md-6">
              <p-autoComplete placeholder="Name" formControlName="name" [suggestions]="localities"
                (completeMethod)="searchLocalities($event)">
              </p-autoComplete>
              <tt-input-message [form]="localityForm" field="name"></tt-input-message>
            </div>
            <div class="p-col-12 p-md-6">
              <div class="form-actions">
                <button pButton *ngIf="!edit" icon="pi pi-check" type="submit" label="Save and continue"
                  (click)="setSaveAndContinue(true)"></button>
                <button pButton icon="pi pi-check" type="submit" label="Save"
                  (click)="setSaveAndContinue(false)"></button>
                <button pButton icon="pi pi-ban" type="button" label="Cancel" (click)="cancelLocality()"></button>
              </div>
            </div>
          </form>
        </section>
      </div>
    </div>
  </div>
  <p-confirmDialog header="Delete Domain" icon="pi pi-exclamation-triangle" key="deleteDomain"></p-confirmDialog>
</app-template>